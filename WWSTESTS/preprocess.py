#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Sun Oct 11 22:25:58 2020

@author: harshittrehan
"""

import glob

def fileLen(fname):
    with open(fname, "r") as rf:
        for i,l in enumerate(rf):
            pass
        if i+1>=1200:
            return True
        else:
            return False

files = glob.glob("../DATA/Malicia (.txt Opcodes)/winwebsec/*.txt")

s = set()   
ts = set()
count = 0

flag = False
fileNum = 1

with open("obseq.txt", "w") as wf:
    for file in files:
        if not fileLen(file):
            continue
        
        if count<30000:
            with open(file, "r") as f:
                for line in f:
                    if count<30000:
                        wf.write(line)
                        count += 1
                    else:
                        break
                    
        elif fileNum<=500:
            if not flag:
                print("---")
                flag = True
                continue
            else:
                testCount = 0
                with open(file, "r") as f:
                    with open("wintest/" + str(fileNum) + "winweb.txt", "w") as tf:
                        for line in f:
                            if testCount<1200:
                                tf.write(line)
                                testCount += 1
                            else:
                                testCount = 0
                                fileNum += 1
                                break  
                            
        else:
            break

with open("obseq.txt", "r") as f:
    for line in f:
        s.add(line)
print(s)

with open("opcodesWWS.txt", "w") as wf:
    for val in s:
        wf.write(val)

files = glob.glob("../DATA/Malicia (.txt Opcodes)/zbot/*.txt")
fileNum = 1
for file in fileszbot:
    if not fileLen(file):
        continue
    
    testCount = 0
    if fileNum<=500:
        with open(file, "r") as f:    
            with open( "zbottest/" + str(fileNum) + "zbot.txt" , "w") as wf:
                for line in f:
                    if testCount<1200:
                        wf.write(line)
                        testCount += 1
                    else:
                        testCount = 0
                        fileNum += 1
                        break
    else:
        break
    
fileszacc = glob.glob('../DATA/Malicia (.txt Opcodes)/zeroaccess/*.txt')

fileNum = 1
for file in fileszacc:
    if fileLen(file):
        testCount = 0
        if fileNum<=500:
            with open(file, "r") as f:    
                with open( "zaccesstest/" + str(fileNum) + "zeroaccess.txt" , "w") as wf:
                    for line in f:
                        if testCount<1200:
                            wf.write(line)
                            testCount += 1
                        else:
                            testCount = 0
                            fileNum += 1
                            break
        else:
            break
    else:
        continue