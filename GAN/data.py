# -*- coding: utf-8 -*-
"""
Created on Tue Mar 30 00:46:20 2021

@author: @harshit
"""
import glob
import json

class DATA():
    def __init__(self, mw_family, file_len):
        self.mw_family = mw_family
        self.file_len = file_len
    
    def file_size(self, fname):
        with open(fname) as f:
            for i, l in enumerate(f):
                pass
        return i + 1
  
    def load_data(self, tokenize):
        path = '../DATA/Malicia (.txt Opcodes)/'+self.mw_family+'/*.txt'
        files = glob.glob(path)
        print(len(files))
        if tokenize:
            with open('../WWSTESTS/opdict.json', "r") as json_file:
                mapping = json.load(json_file)
        data = []
        for file in files:
            if self.file_size(file) >= self.file_len:
                current_file = []
                with open(file, "r") as rf:
                    for line in rf:
                        if len(current_file) < self.file_len:
                            line = line.strip()
                            if tokenize:
                                if line in mapping:
                                    current_file.append(mapping[line])
                                else:
                                    current_file.append(21)
                            else:
                                current_file.append(line)
                        else:
                            break
                    data.append(current_file)
            else:
                continue
        return data
    