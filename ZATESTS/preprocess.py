#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Fri Apr  2 03:22:58 2021

@author: harshittrehan
"""
import glob

def fileLen(fileName):
    with open(fileName, "r") as rf:
        for i,l in enumerate(rf):
            pass
        if i+1 >= 1200:
            return True
        else:
            return False

filesWin = glob.glob("../DATA/Malicia (.txt Opcodes)/winwebsec/*.txt")
filesZbot = glob.glob("../DATA/Malicia (.txt Opcodes)/zbot/*.txt")
filesZacc = glob.glob("../DATA/Malicia (.txt Opcodes)/zeroaccess/*.txt")

s = set()   
ts = set()
count = 0

flag = False
fileNum = 1

with open("obseqZA.txt", "w") as wf:
    for file in filesZacc:
        if not fileLen(file):
            continue
        
        if count<30000:
            with open(file, "r") as f:
                for line in f:
                    if count<30000:
                        wf.write(line)
                        count += 1
                    else:
                        break
                    
        elif fileNum<=500:
            if not flag:
                print("---")
                flag = True
                continue
            else:
                testCount = 0
                with open(file, "r") as f:
                    with open("zaccesstest/" + str(fileNum) + "zeroaccess.txt", "w") as tf:
                        for line in f:
                            if testCount<1200:
                                tf.write(line)
                                testCount += 1
                            else:
                                testCount = 0
                                fileNum += 1
                                break  
                            
        else:
            break

with open("obseqZA.txt", "r") as f:
    for line in f:
        s.add(line)

with open("opcodesZA.txt", "w") as wf:
    for val in s:
        wf.write(val)

fileNum = 1
for file in filesWin:
    if not fileLen(file):
        continue
    
    testCount = 0
    if fileNum<=500:
        with open(file, "r") as f:    
            with open( "wintest/" + str(fileNum) + "winweb.txt" , "w") as wf:
                for line in f:
                    if testCount<1200:
                        wf.write(line)
                        testCount += 1
                    else:
                        testCount = 0
                        fileNum += 1
                        break
    else:
        break

fileNum = 1
for file in filesZbot:
    if fileLen(file):
        testCount = 0
        if fileNum<=500:
            with open(file, "r") as f:    
                with open( "zbottest/" + str(fileNum) + "zbot.txt" , "w") as wf:
                    for line in f:
                        if testCount<1200:
                            wf.write(line)
                            testCount += 1
                        else:
                            testCount = 0
                            fileNum += 1
                            break
        else:
            break
    else:
        continue
